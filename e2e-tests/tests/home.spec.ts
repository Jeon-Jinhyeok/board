/**
 * 홈페이지 E2E 테스트
 * 
 * 이 파일은 Spring Board 애플리케이션의 메인 페이지(홈페이지)를 테스트합니다.
 * 
 * 테스트 항목:
 * 1. 페이지 접속 가능 여부
 * 2. 게시판 제목 표시 여부
 * 3. 카테고리 필터 존재 여부
 * 4. 게시글 테이블 구조 확인
 */

// Playwright 테스트 함수와 검증 함수를 가져옵니다
// test: 테스트 케이스를 정의하는 함수
// expect: 결과를 검증하는 함수 (assertion)
import { test, expect } from '@playwright/test';

// ============================================================
// 테스트 그룹: 홈페이지
// describe 역할을 하는 test.describe로 관련 테스트를 그룹화합니다
// ============================================================
test.describe('홈페이지 테스트', () => {
  
  /**
   * 테스트 1: 홈페이지 접속 및 제목 확인
   * 
   * 목적: 서버가 정상 동작하고 페이지가 올바르게 렌더링되는지 확인
   */
  test('홈페이지에 접속하면 게시판 제목이 표시된다', async ({ page }) => {
    // --------------------------------------------------------
    // page.goto(url): 지정된 URL로 브라우저를 이동시킵니다
    // '/'는 baseURL(http://localhost:8080)을 기준으로 합니다
    // await: 페이지가 완전히 로드될 때까지 대기합니다
    // --------------------------------------------------------
    await page.goto('/');
    
    // --------------------------------------------------------
    // page.locator(selector): CSS 선택자로 DOM 요소를 찾습니다
    // 'h2'는 <h2> 태그를 의미합니다
    // 
    // expect(...).toContainText(text): 요소가 특정 텍스트를 포함하는지 검증
    // '자유 게시판'이 h2 태그 안에 있어야 테스트 통과
    // --------------------------------------------------------
    await expect(page.locator('h2')).toContainText('자유 게시판');
  });

  /**
   * 테스트 2: 페이지 타이틀(브라우저 탭 제목) 확인
   * 
   * 목적: SEO와 사용자 경험을 위한 페이지 제목 설정 확인
   */
  test('페이지 타이틀이 올바르게 설정되어 있다', async ({ page }) => {
    await page.goto('/');
    
    // --------------------------------------------------------
    // expect(page).toHaveTitle(title): 브라우저 탭의 제목을 검증
    // 정규식 /Spring Board/를 사용해 "Spring Board"가 포함되어 있는지 확인
    // --------------------------------------------------------
    await expect(page).toHaveTitle(/Spring Board/);
  });

  /**
   * 테스트 3: 게시글 테이블 구조 확인
   * 
   * 목적: 게시글 목록 테이블이 올바른 컬럼을 가지고 있는지 확인
   */
  test('게시글 목록 테이블에 올바른 헤더가 있다', async ({ page }) => {
    await page.goto('/');
    
    // --------------------------------------------------------
    // page.locator('th'): 테이블 헤더 셀(<th>)을 모두 찾습니다
    // locator는 자동으로 요소가 나타날 때까지 대기합니다 (auto-wait)
    // --------------------------------------------------------
    const headers = page.locator('th');
    
    // --------------------------------------------------------
    // expect(...).toContainText(texts): 여러 텍스트가 순서대로 포함되어 있는지 검증
    // 테이블 헤더가 '번호', '제목', '작성자', '작성일', '조회' 순인지 확인
    // --------------------------------------------------------
    await expect(headers).toContainText(['번호', '제목', '작성자', '작성일', '조회']);
  });

  /**
   * 테스트 4: 글쓰기 링크 확인 (비로그인 상태)
   * 
   * 목적: 비로그인 상태에서 글쓰기 버튼이 보이지 않는지 확인
   * (Spring Security가 제대로 동작하는지 간접 확인)
   */
  test('비로그인 상태에서는 글쓰기 버튼이 보이지 않는다', async ({ page }) => {
    await page.goto('/');
    
    // --------------------------------------------------------
    // page.getByRole('link', { name: '글쓰기' }): 
    // 접근성 역할(role)을 기반으로 요소를 찾습니다
    // 'link' 역할을 가진 요소 중 '글쓰기'라는 이름을 가진 것을 찾습니다
    //
    // .or(page.getByText('글쓰기')): 또는 '글쓰기' 텍스트가 있는 요소
    // 
    // toBeHidden(): 해당 요소가 화면에 보이지 않아야 테스트 통과
    // (비로그인 상태이므로 글쓰기 버튼이 숨겨져 있어야 함)
    // --------------------------------------------------------
    const writeButton = page.getByRole('link', { name: '글쓰기' })
      .or(page.locator('a:has-text("글쓰기")'));
    
    // 글쓰기 버튼이 있다면 숨겨져 있어야 하고, 없다면 count()가 0이어야 함
    const count = await writeButton.count();
    if (count > 0) {
      await expect(writeButton.first()).toBeHidden();
    }
    // count가 0이면 테스트 통과 (버튼 자체가 없음)
  });

  /**
   * 테스트 5: 네비게이션 바 확인
   * 
   * 목적: 공통 레이아웃(네비게이션)이 제대로 렌더링되는지 확인
   */
  test('네비게이션 바가 존재한다', async ({ page }) => {
    await page.goto('/');
    
    // --------------------------------------------------------
    // page.locator('nav'): <nav> 태그를 찾습니다
    // toBeVisible(): 해당 요소가 화면에 보여야 테스트 통과
    // --------------------------------------------------------
    await expect(page.locator('nav')).toBeVisible();
  });
});
